<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QUEST BOARD</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
:root {
  --bg:#0d0d0d; --surface:#161616; --surface2:#1f1f1f; --border:#2a2a2a;
  --accent:#c8f135; --accent2:#f1c835; --accent3:#35c8f1;
  --text:#f0f0f0; --text-dim:#888; --danger:#f13535; --radius:12px;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:'Noto Sans KR',sans-serif;min-height:100vh;overflow-x:hidden;}
.screen{display:none;min-height:100vh;}
.screen.active{display:flex;}

/* LOADING */
#loadingScreen{align-items:center;justify-content:center;flex-direction:column;gap:20px;}
.loading-logo{font-family:'Black Han Sans',sans-serif;font-size:38px;letter-spacing:5px;color:var(--accent);}
.loading-spinner{width:32px;height:32px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}

/* LOGIN */
#loginScreen{flex-direction:column;align-items:center;justify-content:center;position:relative;overflow:hidden;}
#loginScreen::before{content:'';position:absolute;width:600px;height:600px;background:radial-gradient(circle,rgba(200,241,53,.07) 0%,transparent 70%);top:-150px;left:-150px;pointer-events:none;}
#loginScreen::after{content:'';position:absolute;width:400px;height:400px;background:radial-gradient(circle,rgba(53,200,241,.05) 0%,transparent 70%);bottom:-50px;right:-50px;pointer-events:none;}
.login-box{background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:48px 40px;width:380px;max-width:92vw;position:relative;z-index:1;}
.login-logo{font-family:'Black Han Sans',sans-serif;font-size:38px;letter-spacing:5px;color:var(--accent);text-align:center;margin-bottom:4px;}
.login-sub{text-align:center;color:var(--text-dim);font-size:12px;letter-spacing:3px;margin-bottom:40px;}
.input-group{margin-bottom:16px;}
.input-group label{display:block;font-size:11px;color:var(--text-dim);margin-bottom:7px;letter-spacing:1.5px;text-transform:uppercase;}
.input-group input{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:13px 16px;color:var(--text);font-size:15px;font-family:'Noto Sans KR',sans-serif;outline:none;transition:border-color .2s;}
.input-group input:focus{border-color:var(--accent);}
.btn-primary{width:100%;background:var(--accent);color:#0d0d0d;border:none;border-radius:8px;padding:14px;font-size:15px;font-weight:700;font-family:'Noto Sans KR',sans-serif;cursor:pointer;margin-top:8px;transition:opacity .2s,transform .1s;letter-spacing:1px;}
.btn-primary:hover{opacity:.88;}
.btn-primary:active{transform:scale(.98);}
.btn-primary:disabled{opacity:.5;cursor:not-allowed;}
.login-error{color:var(--danger);font-size:13px;text-align:center;margin-top:14px;display:none;}

/* NAV */
.topnav{position:fixed;top:0;left:0;right:0;height:56px;background:rgba(13,13,13,.96);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 24px;z-index:100;}
.nav-logo{font-family:'Black Han Sans',sans-serif;font-size:20px;color:var(--accent);letter-spacing:3px;}
.nav-badge{font-size:10px;color:var(--accent2);letter-spacing:1px;margin-left:6px;vertical-align:middle;}
.nav-right{display:flex;align-items:center;gap:10px;}
.nav-user{font-size:13px;color:var(--text-dim);}
.btn-sm{background:var(--surface2);border:1px solid var(--border);color:var(--text);border-radius:6px;padding:6px 14px;font-size:13px;font-family:'Noto Sans KR',sans-serif;cursor:pointer;transition:border-color .2s,color .2s;white-space:nowrap;}
.btn-sm:hover{border-color:var(--accent);color:var(--accent);}

/* ADMIN */
#adminScreen{flex-direction:column;padding-top:56px;}
.page-content{padding:32px 24px;max-width:820px;margin:0 auto;width:100%;}
.section-title{font-family:'Black Han Sans',sans-serif;font-size:20px;letter-spacing:2px;margin-bottom:20px;color:var(--accent);}
.admin-hero{text-align:center;padding:36px 0 28px;border-bottom:1px solid var(--border);margin-bottom:36px;}
.admin-hero-title{font-family:'Black Han Sans',sans-serif;font-size:26px;letter-spacing:4px;color:var(--accent2);margin-bottom:8px;}
.admin-hero-sub{color:var(--text-dim);font-size:14px;}
.create-form{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:28px;max-width:460px;margin:0 auto;}
.form-row{margin-bottom:16px;}
.form-row label{display:block;font-size:11px;color:var(--text-dim);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:7px;}
.form-row input{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:12px 14px;color:var(--text);font-size:14px;font-family:'Noto Sans KR',sans-serif;outline:none;transition:border-color .2s;}
.form-row input:focus{border-color:var(--accent2);}
.btn-accent{background:var(--accent);color:#0d0d0d;border:none;border-radius:8px;padding:13px 24px;font-size:14px;font-weight:700;font-family:'Noto Sans KR',sans-serif;cursor:pointer;transition:opacity .2s,transform .1s;letter-spacing:1px;}
.btn-accent:hover{opacity:.85;}
.btn-accent.full{width:100%;margin-top:4px;}
.admin-user-list{margin-top:44px;}
.user-chip-list{display:flex;flex-wrap:wrap;gap:10px;max-width:460px;margin:0 auto;}
.user-chip{background:var(--surface);border:1px solid var(--border);border-radius:100px;padding:8px 18px;display:flex;align-items:center;gap:10px;}
.user-chip-name{font-weight:700;font-size:14px;}
.user-chip-id{color:var(--text-dim);font-size:12px;}

/* ===== NEW DASHBOARD ===== */
#dashboardScreen{flex-direction:column;padding-top:56px;}

/* ì „ì²´ ì§„ì²™ë¥  ë°” */
.global-progress-bar{background:var(--surface);border-bottom:1px solid var(--border);padding:16px 24px;}
.gp-inner{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:16px;}
.gp-label{font-family:'Black Han Sans',sans-serif;font-size:13px;letter-spacing:2px;color:var(--text-dim);white-space:nowrap;}
.gp-track{flex:1;height:8px;background:var(--surface2);border-radius:4px;overflow:hidden;}
.gp-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:4px;transition:width .6s ease;}
.gp-pct{font-family:'Black Han Sans',sans-serif;font-size:18px;color:var(--accent);min-width:48px;text-align:right;}

/* ë©”ì¸ 3ë‹¨ ë ˆì´ì•„ì›ƒ */
.dash-layout{display:grid;grid-template-columns:220px 1fr 220px;gap:0;flex:1;max-width:1100px;margin:0 auto;width:100%;padding:0 0 32px;}

/* ì¢Œì¸¡ ëª©í‘œ ë²„íŠ¼ */
.goal-sidebar{padding:24px 16px;border-right:1px solid var(--border);display:flex;flex-direction:column;gap:10px;}
.goal-sidebar-title{font-size:11px;letter-spacing:2px;color:var(--text-dim);text-transform:uppercase;margin-bottom:8px;padding:0 4px;}
.goal-btn{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 16px;cursor:pointer;transition:border-color .2s,background .2s,transform .1s;text-align:left;width:100%;font-family:'Noto Sans KR',sans-serif;}
.goal-btn:hover:not(.disabled){border-color:var(--accent);transform:translateX(2px);}
.goal-btn.active{border-color:var(--accent);background:rgba(200,241,53,.08);}
.goal-btn.disabled{opacity:.35;cursor:default;border-style:dashed;}
.goal-btn-title{font-size:13px;font-weight:700;color:var(--text);margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.goal-btn-pct{font-family:'Black Han Sans',sans-serif;font-size:16px;color:var(--accent);}
.goal-btn.disabled .goal-btn-title{color:var(--text-dim);}
.goal-btn.disabled .goal-btn-pct{display:none;}
.goal-btn-bar{height:3px;background:var(--border);border-radius:2px;overflow:hidden;margin-top:6px;}
.goal-btn-fill{height:100%;background:var(--accent);border-radius:2px;transition:width .4s ease;}

/* ì¤‘ì•™ ìƒì„¸ */
.detail-panel{padding:24px;overflow-y:auto;}
.detail-empty{display:flex;align-items:center;justify-content:center;height:100%;color:var(--text-dim);font-size:15px;text-align:center;line-height:1.8;}

/* ë‹¨ìœ„ ì„¤ì • */
.unit-setup{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:28px;}
.unit-setup-title{font-family:'Black Han Sans',sans-serif;font-size:18px;letter-spacing:2px;margin-bottom:8px;}
.unit-setup-sub{color:var(--text-dim);font-size:13px;margin-bottom:24px;}
.unit-options{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:24px;}
.unit-opt{background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:14px 10px;cursor:pointer;text-align:center;font-size:13px;font-weight:500;transition:border-color .2s,background .2s;font-family:'Noto Sans KR',sans-serif;color:var(--text);}
.unit-opt:hover{border-color:var(--accent);}
.unit-opt.selected{border-color:var(--accent);background:rgba(200,241,53,.1);color:var(--accent);}
.unit-confirm-btn{background:var(--accent);color:#0d0d0d;border:none;border-radius:8px;padding:13px 32px;font-size:14px;font-weight:700;font-family:'Noto Sans KR',sans-serif;cursor:pointer;transition:opacity .2s;}
.unit-confirm-btn:hover{opacity:.85;}

/* ë‹¬ë ¥ ì˜ì—­ */
.calendar-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;}
.cal-goal-title{font-family:'Black Han Sans',sans-serif;font-size:20px;letter-spacing:2px;}
.cal-meta{display:flex;align-items:center;gap:12px;}
.cal-unit-badge{background:var(--surface2);border:1px solid var(--border);border-radius:100px;padding:4px 12px;font-size:12px;color:var(--text-dim);}
.edit-unit-btn{background:transparent;border:1px solid var(--border);color:var(--text-dim);border-radius:6px;padding:5px 12px;font-size:12px;font-family:'Noto Sans KR',sans-serif;cursor:pointer;transition:border-color .2s,color .2s;}
.edit-unit-btn:hover{border-color:var(--accent);color:var(--accent);}

.month-nav{display:flex;align-items:center;gap:12px;margin-bottom:16px;}
.month-nav-btn{background:var(--surface2);border:1px solid var(--border);color:var(--text);border-radius:6px;padding:6px 14px;font-size:14px;cursor:pointer;transition:border-color .2s;}
.month-nav-btn:hover{border-color:var(--accent);}
.month-label{font-family:'Black Han Sans',sans-serif;font-size:16px;letter-spacing:2px;}

/* ë‹¬ë ¥ ê·¸ë¦¬ë“œ */
.cal-grid-header{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:4px;}
.cal-day-label{text-align:center;font-size:11px;color:var(--text-dim);padding:4px 0;}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;}
.cal-cell{aspect-ratio:1;background:var(--surface);border:1px solid var(--border);border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:border-color .2s,background .2s,transform .1s;position:relative;user-select:none;}
.cal-cell:hover:not(.empty):not(.future){border-color:var(--accent);transform:scale(1.04);}
.cal-cell.empty{background:transparent;border-color:transparent;cursor:default;}
.cal-cell.future{opacity:.35;cursor:default;}
.cal-cell.done{background:var(--accent);border-color:var(--accent);}
.cal-cell.done .cal-date{color:#0d0d0d;}
.cal-cell.week-complete{background:rgba(200,241,53,.15);border-color:rgba(200,241,53,.5);}
.cal-date{font-size:12px;font-weight:500;}
.cal-check{font-size:14px;margin-top:2px;opacity:0;}
.cal-cell.done .cal-check{opacity:1;color:#0d0d0d;}
.cal-today{border-color:var(--accent3) !important;}
.cal-today .cal-date{color:var(--accent3);}

/* ì›”ê°„ ì§„ì²™ */
.month-progress{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px 20px;margin-top:16px;display:flex;align-items:center;gap:16px;}
.mp-label{font-size:13px;color:var(--text-dim);white-space:nowrap;}
.mp-track{flex:1;height:6px;background:var(--surface2);border-radius:3px;overflow:hidden;}
.mp-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:3px;transition:width .5s ease;}
.mp-nums{font-family:'Black Han Sans',sans-serif;font-size:14px;color:var(--accent);white-space:nowrap;}

/* í•œë²ˆ ì™„ë£Œ UI */
.once-panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:32px;text-align:center;}
.once-title{font-family:'Black Han Sans',sans-serif;font-size:18px;letter-spacing:2px;margin-bottom:8px;}
.once-sub{color:var(--text-dim);font-size:13px;margin-bottom:28px;}
.once-btn{background:var(--surface2);border:2px solid var(--border);border-radius:50%;width:100px;height:100px;font-size:36px;cursor:pointer;transition:border-color .2s,transform .15s;display:inline-flex;align-items:center;justify-content:center;}
.once-btn:hover{border-color:var(--accent);transform:scale(1.08);}
.once-btn.completed{background:rgba(200,241,53,.15);border-color:var(--accent);}
.once-done-label{margin-top:16px;font-family:'Black Han Sans',sans-serif;font-size:16px;color:var(--accent);}

/* ìš°ì¸¡ ì•„ë°”íƒ€ */
.avatar-sidebar{padding:24px 16px;border-left:1px solid var(--border);display:flex;flex-direction:column;align-items:center;gap:16px;}
.avatar-stage-label{font-size:11px;letter-spacing:2px;color:var(--text-dim);text-transform:uppercase;}
.avatar-canvas-wrap{width:140px;height:140px;display:flex;align-items:center;justify-content:center;background:var(--surface);border:1px solid var(--border);border-radius:16px;overflow:hidden;}
.avatar-canvas{image-rendering:pixelated;width:128px;height:128px;}
.avatar-stage-name{font-family:'Black Han Sans',sans-serif;font-size:16px;letter-spacing:2px;color:var(--accent);}
.avatar-msg{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px 14px;font-size:12px;color:var(--text-dim);line-height:1.6;text-align:center;width:100%;}

/* TOAST */
.toast{position:fixed;bottom:32px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--accent);color:#0d0d0d;padding:12px 26px;border-radius:100px;font-weight:700;font-size:14px;transition:transform .3s ease;z-index:999;pointer-events:none;white-space:nowrap;}
.toast.show{transform:translateX(-50%) translateY(0);}

/* ë°˜ì‘í˜• */
@media(max-width:900px){
  .dash-layout{grid-template-columns:1fr;grid-template-rows:auto 1fr auto;}
  .goal-sidebar{flex-direction:row;flex-wrap:wrap;border-right:none;border-bottom:1px solid var(--border);padding:16px;}
  .goal-btn{flex:1;min-width:140px;}
  .avatar-sidebar{flex-direction:row;flex-wrap:wrap;border-left:none;border-top:1px solid var(--border);justify-content:center;}
}
</style>
</head>
<body>

<!-- LOADING -->
<div id="loadingScreen" class="screen active">
  <div class="loading-logo">QUEST</div>
  <div class="loading-spinner"></div>
</div>

<!-- LOGIN -->
<div id="loginScreen" class="screen">
  <div class="login-box">
    <div class="login-logo">QUEST</div>
    <div class="login-sub">BOARD</div>
    <div class="input-group"><label>ì•„ì´ë””</label><input type="text" id="loginId" placeholder="ì•„ì´ë”” ì…ë ¥" autocomplete="username"></div>
    <div class="input-group"><label>ë¹„ë°€ë²ˆí˜¸</label><input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" autocomplete="current-password"></div>
    <button class="btn-primary" id="loginBtn" onclick="doLogin()">ë¡œê·¸ì¸</button>
    <div class="login-error" id="loginError">ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
  </div>
</div>

<!-- ADMIN -->
<div id="adminScreen" class="screen">
  <nav class="topnav">
    <div class="nav-logo">QUEST <span class="nav-badge">ADMIN</span></div>
    <div class="nav-right"><button class="btn-sm" onclick="doLogout()">ë¡œê·¸ì•„ì›ƒ</button></div>
  </nav>
  <div class="page-content">
    <div class="admin-hero">
      <div class="admin-hero-title">ADMIN PANEL</div>
      <div class="admin-hero-sub">ìœ ì € ê³„ì •ì„ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</div>
    </div>
    <div class="create-form">
      <div class="section-title" style="font-size:16px;margin-bottom:20px;">ìƒˆ ê³„ì • ìƒì„±</div>
      <div class="form-row"><label>ì´ë¦„</label><input type="text" id="newUserName" placeholder="ìœ ì € ì´ë¦„"></div>
      <div class="form-row"><label>ì•„ì´ë””</label><input type="text" id="newUserId" placeholder="ë¡œê·¸ì¸ ì•„ì´ë””"></div>
      <div class="form-row"><label>ë¹„ë°€ë²ˆí˜¸</label><input type="text" id="newUserPw" placeholder="ë¹„ë°€ë²ˆí˜¸"></div>
      <button class="btn-accent full" onclick="createUser()">ê³„ì • ìƒì„±</button>
    </div>
    <div class="admin-user-list">
      <div class="section-title" style="font-size:16px;text-align:center;margin-bottom:16px;">ë“±ë¡ëœ ìœ ì €</div>
      <div class="user-chip-list" id="adminUserChips"></div>
    </div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboardScreen" class="screen">
  <nav class="topnav">
    <div class="nav-logo">QUEST</div>
    <div class="nav-right">
      <span class="nav-user" id="navUserName"></span>
      <button class="btn-sm" onclick="doLogout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </nav>

  <!-- ì „ì²´ ì§„ì²™ë¥  ë°” -->
  <div class="global-progress-bar">
    <div class="gp-inner">
      <div class="gp-label">ì´ë²ˆ ë‹¬ ì „ì²´</div>
      <div class="gp-track"><div class="gp-fill" id="gpFill" style="width:0%"></div></div>
      <div class="gp-pct" id="gpPct">0%</div>
    </div>
  </div>

  <!-- 3ë‹¨ ë ˆì´ì•„ì›ƒ -->
  <div class="dash-layout">
    <!-- ì¢Œì¸¡: ëª©í‘œ ë²„íŠ¼ -->
    <div class="goal-sidebar">
      <div class="goal-sidebar-title">ëª©í‘œ</div>
      <div id="goalBtnList"></div>
    </div>

    <!-- ì¤‘ì•™: ìƒì„¸ -->
    <div class="detail-panel" id="detailPanel">
      <div class="detail-empty">â† ëª©í‘œë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
    </div>

    <!-- ìš°ì¸¡: ì•„ë°”íƒ€ -->
    <div class="avatar-sidebar">
      <div class="avatar-stage-label">ë‚˜ì˜ ì•„ë°”íƒ€</div>
      <div class="avatar-canvas-wrap">
        <canvas class="avatar-canvas" id="avatarCanvas" width="16" height="16"></canvas>
      </div>
      <div class="avatar-stage-name" id="avatarStageName">1ë‹¨ê³„</div>
      <div class="avatar-msg" id="avatarMsg">ì˜¤ëŠ˜ë„ íŒŒì´íŒ…!</div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAbEbLdJuWVai_NKTHuo1XtC8p76dmVPE0",
  authDomain: "grow-goal.firebaseapp.com",
  databaseURL: "https://grow-goal-default-rtdb.firebaseio.com",
  projectId: "grow-goal",
  storageBucket: "grow-goal.firebasestorage.app",
  messagingSenderId: "587441793315",
  appId: "1:587441793315:web:8ae5325a2af90953ce4496",
  measurementId: "G-YPQ00335VX"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ===== ìƒìˆ˜ =====
const UNIT_LABELS = {
  once: 'í•œ ë²ˆ',
  daily: 'ë§¤ì¼',
  w1: 'ì£¼ 1íšŒ',
  w2: 'ì£¼ 2~3íšŒ',
  w4: 'ì£¼ 4~5íšŒ',
  w6: 'ì£¼ 6íšŒ'
};
const UNIT_FREQ = { once:0, daily:7, w1:1, w2:2, w4:4, w6:6 };

// ê³ ì • ëª©í‘œ ìŠ¬ë¡¯ (1ë²ˆì€ ê³ ì •)
const FIXED_GOAL = { title: '12ì‹œì— ëˆ•ê¸°', fixed: true };

// ===== 365ê°œ ì‘ì› ë©˜íŠ¸ =====
const CHEERS = [
  "ì˜¤ëŠ˜ë„ í•œ ê±¸ìŒ!","ì‘ì€ ì‹œì‘ì´ í° ë³€í™”ë¥¼ ë§Œë“¤ì–´ìš”","í¬ê¸°í•˜ì§€ ë§ˆì„¸ìš”!","ì˜ í•˜ê³  ìˆì–´ìš”!","ì˜¤ëŠ˜ì˜ ë…¸ë ¥ì´ ë‚´ì¼ì˜ ë‚˜ë¥¼ ë§Œë“¤ì–´ìš”",
  "ê¾¸ì¤€í•¨ì´ ìµœê³ ì˜ ë¬´ê¸°ì˜ˆìš”","ì–´ì œë³´ë‹¤ ë‚˜ì€ ì˜¤ëŠ˜!","ì¡°ê¸ˆì”© ë‚˜ì•„ê°€ëŠ” ì¤‘!","ë‹¹ì‹ ì€ í•  ìˆ˜ ìˆì–´ìš”","ë§¤ì¼ì´ ìƒˆë¡œìš´ ê¸°íšŒì˜ˆìš”",
  "í˜ë‚´ì„¸ìš”, ì‘ì›í•´ìš”!","ì˜¤ëŠ˜ í•˜ë£¨ë„ ìˆ˜ê³ í–ˆì–´ìš”","ì‘ì€ ìŠµê´€ì´ ì¸ìƒì„ ë°”ê¿”ìš”","ë©ˆì¶”ì§€ ì•Šìœ¼ë©´ ë°˜ë“œì‹œ ë„ë‹¬í•´ìš”","ì²œì²œíˆ ê°€ë„ ê´œì°®ì•„ìš”",
  "ì§€ê¸ˆ ì´ ìˆœê°„ì´ ì¤‘ìš”í•´ìš”","ì˜¤ëŠ˜ë„ ë©‹ì§„ í•˜ë£¨ì˜€ì–´ìš”","í•œ ë²ˆì— í•œ ê±¸ìŒì”©","ë‹¹ì‹ ì˜ ë…¸ë ¥ì„ ì‘ì›í•´ìš”","ëª©í‘œì— ê°€ê¹Œì›Œì§€ê³  ìˆì–´ìš”",
  "ì‘ì€ ì„±ê³µì„ ì¶•í•˜í•´ìš”","ì˜¤ëŠ˜ë„ ì˜ í–ˆì–´ìš”!","í¬ê¸°ë€ ì—†ì–´ìš”!","ë‚´ì¼ì€ ë” ì˜ ë  ê±°ì˜ˆìš”","ì§€ê¸ˆ ì˜ í•˜ê³  ìˆì–´ìš”",
  "ì˜¤ëŠ˜ì˜ ë•€ì´ ë¹›ë‚  ê±°ì˜ˆìš”","ìŠµê´€ì´ ìš´ëª…ì„ ë°”ê¿”ìš”","ë‹¹ì‹ ì€ íŠ¹ë³„í•´ìš”","ë§¤ì¼ ì¡°ê¸ˆì”© ì„±ì¥ ì¤‘","íŒŒì´íŒ…!",
  "ì˜¤ëŠ˜ í•˜ë£¨ ìµœì„ ì„ ë‹¤í–ˆì–´ìš”","ê¸°ë¡ì´ ìŒ“ì—¬ ì‹¤ë ¥ì´ ë¼ìš”","ê¾¸ì¤€í•œ ë‹¹ì‹ ì´ ë©‹ì ¸ìš”","ì˜¤ëŠ˜ë„ ìŠ¹ë¦¬!","ë…¸ë ¥ì€ ë°°ì‹ í•˜ì§€ ì•Šì•„ìš”",
  "ì´ ìˆœê°„ì„ ì¦ê¸°ì„¸ìš”","í•œ ê±¸ìŒ ë” ë‚˜ì•„ê°”ì–´ìš”","ë‹¹ì‹ ì˜ ê°€ëŠ¥ì„±ì€ ë¬´í•œí•´ìš”","í¬ê¸°í•˜ì§€ ì•ŠëŠ” ë‹¹ì‹  ìµœê³ ","ì˜¤ëŠ˜ë„ í•´ëƒˆì–´ìš”!",
  "ë³€í™”ëŠ” ì‹œì‘ëì–´ìš”","ì§€ì¹˜ì§€ ë§ˆì„¸ìš”, ê³§ ë¹›ë‚  ê±°ì˜ˆìš”","ì‘ì›ì´ í•¨ê»˜í•´ìš”","ì˜¤ëŠ˜ë„ ì„±ì¥í–ˆì–´ìš”","ë‚´ í˜ì´ìŠ¤ëŒ€ë¡œ ê°€ìš”",
  "ë‹¹ì‹ ì˜ ë…¸ë ¥ì´ ëˆˆë¶€ì…”ìš”","í•˜ë£¨í•˜ë£¨ê°€ ìŒ“ì—¬ìš”","ì˜¤ëŠ˜ë„ ëê¹Œì§€!","ì‹¤íŒ¨í•´ë„ ê´œì°®ì•„ìš”, ë‹¤ì‹œ ì¼ì–´ì„œë©´ ë¼ìš”","ì›°ë˜!",
  "ì‘ì€ ëª©í‘œë¶€í„° ì°¨ê·¼ì°¨ê·¼","ì„±ê³µì˜ ì”¨ì•—ì„ ì‹¬ëŠ” ì¤‘","ì˜¤ëŠ˜ í•˜ë£¨ ì¶©ì „ ì™„ë£Œ","ë‹¹ì‹ ì€ ì„±ì¥í•˜ëŠ” ì¤‘ì´ì—ìš”","ë©ˆì¶”ì§€ ì•ŠëŠ” ìš©ê¸°!",
  "í•˜ë£¨ë¥¼ ì˜ ë§ˆë¬´ë¦¬í–ˆì–´ìš”","ì§€ê¸ˆì˜ ë…¸ë ¥ì„ ë¯¿ì–´ìš”","ëª¨ë“  ìˆœê°„ì´ ì˜ë¯¸ ìˆì–´ìš”","ì¢‹ì€ ìŠµê´€ ë§Œë“œëŠ” ì¤‘","ì˜¤ëŠ˜ë„ ì¢‹ì€ ì„ íƒ!",
  "ë¯¸ë˜ì˜ ë‚˜ë¥¼ ìœ„í•œ íˆ¬ìì˜ˆìš”","ì§€ê¸ˆ ë‹¹ì‹  ìµœê³ ì˜ˆìš”","ì‘ì€ ë³€í™”ê°€ í° ê¸°ì ì„ ë§Œë“¤ì–´ìš”","ì˜¤ëŠ˜ë„ ìë‘ìŠ¤ëŸ¬ì›Œìš”","ì•ìœ¼ë¡œë§Œ!",
  "ë‹¹ì‹ ì˜ ì—´ì •ì´ ë¹›ë‚˜ìš”","ì¡°ê¸ˆë§Œ ë” í˜ë‚´ìš”","í¬ê¸° ê¸ˆì§€!","ë§¤ì¼ ì¡°ê¸ˆì”© ë” ê°•í•´ì ¸ìš”","ì˜¤ëŠ˜ì˜ ìŠµê´€ì´ ë¯¸ë˜ë¥¼ ê²°ì •í•´ìš”",
  "ì˜ ìê³  ë‚´ì¼ ë˜ íŒŒì´íŒ…!","ì–´ì œì˜ ë‚˜ë³´ë‹¤ ë‚˜ì•„ì¡Œì–´ìš”","í‰ë²”í•œ ë‚ ë„ ì†Œì¤‘í•´ìš”","ë£¨í‹´ì´ ì‚¶ì„ ë°”ê¿”ìš”","ëª©í‘œë¥¼ í–¥í•´ ì „ì§„ ì¤‘!",
  "ë‹¹ì‹ ì˜ ì˜ì§€ë ¥ì´ ëŒ€ë‹¨í•´ìš”","ì˜¤ëŠ˜ í•˜ë£¨ ìµœê³ ì˜€ì–´ìš”","í•œ ë²ˆ ë” ë„ì „!","ì§€ê¸ˆ ì´ ìˆœê°„ì„ ì¦ê²¨ìš”","í¬ê¸°í•˜ì§€ ì•ŠëŠ” í˜ì´ ìµœê³ ì˜ˆìš”",
  "ë¹›ë‚˜ëŠ” ë¯¸ë˜ë¥¼ í–¥í•´","ì˜¤ëŠ˜ë„ í•´í”¼ í€˜ìŠ¤íŠ¸!","ë…¸ë ¥í•˜ëŠ” ë‹¹ì‹ ì´ ì•„ë¦„ë‹¤ì›Œìš”","ë‚´ì¼ë„ ê°™ì´ í•´ìš”","ì˜¤ëŠ˜ì˜ ì²´í¬ê°€ ë¹›ë‚˜ìš”",
  "ì¡°ê¸ˆì”©, í™•ì‹¤í•˜ê²Œ","ë‹¹ì‹ ì˜ ë£¨í‹´ì´ ì™„ì„±ë˜ì–´ ê°€ìš”","ì´ ìˆœê°„ì— ì§‘ì¤‘í•´ìš”","ì˜¤ëŠ˜ë„ ì™„ë²½í•œ í•˜ë£¨!","êµ¿ ì¡!",
  "í•œ ë°œì”© ë‚˜ì•„ê°€ëŠ” ì¤‘","ë‹¹ì‹ ì˜ ê¾¸ì¤€í•¨ì´ ëŒ€ë‹¨í•´ìš”","ì˜¤ëŠ˜ë„ í›Œë¥­í–ˆì–´ìš”","ë©‹ì§„ ìŠµê´€ì„ ë§Œë“œëŠ” ì¤‘","ê³„ì† ê°€ìš”!",
  "ì˜¤ëŠ˜ë„ ê¸°ë¡ ì™„ë£Œ!","ë‹¹ì‹ ì€ ë§¤ì¼ ì„±ì¥í•´ìš”","ì´ ìŠµê´€ì´ ë‹¹ì‹ ì„ ë°”ê¿€ ê±°ì˜ˆìš”","ì˜¤ëŠ˜ë„ ì¶©ì‹¤í–ˆì–´ìš”","í•œê³„ë¥¼ ë„˜ì–´ì„œìš”",
  "ê¿ˆì„ í–¥í•œ ì‘ì€ ë°œê±¸ìŒ","ì˜¤ëŠ˜ë„ íŒŒì´íŒ… ë„˜ì³ìš”","ë‹¹ì‹ ì˜ í•˜ë£¨ê°€ ëˆˆë¶€ì…”ìš”","ì§€ê¸ˆ ì˜ ë‹¬ë¦¬ê³  ìˆì–´ìš”","ë‚´ì¼ë„ ê¸°ëŒ€ë¼ìš”",
  "ì‘ì€ ì™„ë£Œê°€ ëª¨ì—¬ ì„±ê³µì´ ë¼ìš”","ì˜¤ëŠ˜ë„ ì²´í¬ ì™„ë£Œ!","ë‹¹ì‹ ì˜ ëˆê¸°ê°€ ë©‹ì ¸ìš”","í•œ ê±¸ìŒì˜ ê¸°ì ","ì˜¤ëŠ˜ë„ ì´ê²¨ëƒˆì–´ìš”!",
  "ë‚´ ì•ˆì˜ ê°€ëŠ¥ì„±ì„ ë¯¿ì–´ìš”","ì˜¤ëŠ˜ë„ ë£¨í‹´ ì™„ì„±!","ë‹¹ì‹ ì˜ ë…¸ë ¥ì„ ë¯¿ì–´ìš”","ì¡°ê¸ˆì”© ë” ë‚˜ì€ ë‚˜ë¡œ","ì˜¤ëŠ˜ í•˜ë£¨ ì±™ê²¼ì–´ìš”",
  "ì˜¤ëŠ˜ë„ ìµœì„ !","ë‹¹ì‹ ì˜ ì„±ì¥ì´ ëŠê»´ì ¸ìš”","ë©ˆì¶”ì§€ ì•ŠëŠ” ê²ƒì´ ìµœê³ ì˜ˆìš”","ì˜¤ëŠ˜ë„ ë¸Œë¼ë³´!","í•œ ë°œ ì•ì„œê°€ëŠ” ë‹¹ì‹ ",
  "ê¾¸ì¤€í•¨ì´ ì‹¤ë ¥ì´ ë¼ìš”","ì˜¤ëŠ˜ë„ í›Œë¥­í•œ ì„ íƒ!","ë‹¹ì‹ ì˜ ê²°ì‹¬ì´ ëŒ€ë‹¨í•´ìš”","ì˜¤ëŠ˜ í•˜ë£¨ ì˜ ë²„í…¼ì–´ìš”","ë‚´ì¼ì˜ ë‚˜ì—ê²Œ ì„ ë¬¼í•˜ëŠ” ì˜¤ëŠ˜",
  "ì˜¤ëŠ˜ë„ ì‰¬ì§€ ì•Šì•˜ì–´ìš”","ë‹¹ì‹ ì˜ ì˜ì§€ê°€ ë¹›ë‚˜ìš”","ë£¨í‹´ì˜ ë‹¬ì¸ì´ ë˜ì–´ê°€ëŠ” ì¤‘","ì˜¤ëŠ˜ë„ ê¸°íŠ¹í•´ìš”","ìŠµê´€ì´ ë‚˜ë¥¼ ë§Œë“¤ì–´ìš”",
  "ì‘ì§€ë§Œ í™•ì‹¤í•œ ì§„ì „","ì˜¤ëŠ˜ë„ ìŠ¤ìŠ¤ë¡œ ì¹­ì°¬í•´ìš”","ë‹¹ì‹ ì€ ë§¤ì¼ ë” ê°•í•´ì ¸ìš”","ì˜¤ëŠ˜ì˜ ë…¸ë ¥ ë°•ìˆ˜!","ì•ë§Œ ë³´ê³  ê°€ìš”",
  "ì§€ê¸ˆ ì´ ìˆœê°„ì´ ì†Œì¤‘í•´ìš”","ì˜¤ëŠ˜ë„ í•œ í˜ì´ì§€ ì™„ì„±","ë‹¹ì‹ ì˜ ì—¬ì •ì„ ì‘ì›í•´ìš”","ë§¤ì¼ ì¡°ê¸ˆì”© ë¹›ë‚˜ìš”","ì˜¤ëŠ˜ë„ ì˜ í–ˆì–´!",
  "í¬ê¸°í•˜ì§€ ì•ŠëŠ” ë‹¹ì‹  ë©‹ì ¸ìš”","ì˜¤ëŠ˜ì˜ ë„ì „ ì„±ê³µ!","ë‹¹ì‹ ì˜ í•˜ë£¨ê°€ ê°’ì ¸ìš”","ì´ ìŠµê´€ì´ ì˜¤ë˜ê°€ê¸¸","ì˜¤ëŠ˜ë„ ê±´ê°•í•œ í•˜ë£¨",
  "ì¡°ê¸ˆë§Œ ë”, í•  ìˆ˜ ìˆì–´ìš”","ì˜¤ëŠ˜ë„ ì™„ì„±í–ˆì–´ìš”","ë‹¹ì‹ ì˜ ë…¸ë ¥ì´ ìŒ“ì—¬ìš”","ì´ ìˆœê°„ì„ ê¸°ì–µí•´ìš”","ì˜¤ëŠ˜ë„ ìŠ¹ë¦¬ì˜ í•˜ë£¨!",
  "ë‹¹ì‹ ì´ ìë‘ìŠ¤ëŸ¬ì›Œìš”","ì˜¤ëŠ˜ë„ ìµœê³ ì˜ ì„ íƒ!","ë£¨í‹´ì´ ì‚¶ì„ í’ìš”ë¡­ê²Œ í•´ìš”","ì˜¤ëŠ˜ë„ ê±´ê°•í•œ ìŠµê´€","í•œ ê±¸ìŒì”© ë‚˜ì•„ê°€ìš”",
  "ì˜¤ëŠ˜ì˜ ì‘ì€ ì„±ì·¨ê°€ ë¹›ë‚˜ìš”","ë‹¹ì‹ ì˜ ê¾¸ì¤€í•¨ì„ ì‘ì›í•´ìš”","ì˜¤ëŠ˜ë„ ì˜ í•´ëƒˆì–´ìš”","ë©ˆì¶”ì§€ ì•Šê³  ë‹¬ë ¤ìš”","ë‹¹ì‹ ì€ ë³€í•˜ê³  ìˆì–´ìš”",
  "ì˜¤ëŠ˜ë„ ìµœì„ ì„ ë‹¤í–ˆì–´ìš”","ë§¤ì¼ì´ ì„±ì¥ì˜ ê¸°íšŒì˜ˆìš”","ì˜¤ëŠ˜ë„ ìŠ¤ìŠ¤ë¡œë¥¼ ë¯¿ì–´ìš”","ì‘ì€ ëª©í‘œ í´ë¦¬ì–´!","ë‹¹ì‹ ì˜ í•˜ë£¨ê°€ ë¹›ë‚˜ìš”",
  "ì˜¤ëŠ˜ë„ í•œ ê±¸ìŒ ë”","ì§€ì¹˜ì§€ ì•ŠëŠ” ë‹¹ì‹  ëŒ€ë‹¨í•´ìš”","ì´ ëª©í‘œ ë°˜ë“œì‹œ ì´ë¤„ì ¸ìš”","ì˜¤ëŠ˜ì˜ ë‚˜ íŒŒì´íŒ…!","ì‘ì€ ê¸°ë¡ì´ í° ë³€í™”ë¥¼ ë§Œë“¤ì–´ìš”",
  "ì˜¤ëŠ˜ë„ ì˜ ë§ˆë¬´ë¦¬í–ˆì–´ìš”","ë‹¹ì‹ ì˜ ì˜ì§€ë ¥ ìµœê³ ì˜ˆìš”","ë§¤ì¼ ì„±ì¥í•˜ëŠ” ë‹¹ì‹ ","ì˜¤ëŠ˜ë„ ì²´í¬ ì„±ê³µ!","í•œ ë²ˆì— í•˜ë‚˜ì”©",
  "ì˜¤ëŠ˜ë„ ì¢‹ì€ í•˜ë£¨ì˜€ì–´ìš”","ë‹¹ì‹ ì˜ ëª©í‘œë¥¼ í–¥í•´","ë©ˆì¶”ì§€ ì•Šìœ¼ë©´ ì„±ê³µí•´ìš”","ì˜¤ëŠ˜ë„ ë©‹ì§„ ì„ íƒ!","ì´ ìŠµê´€ì´ ì‚¶ì„ ë°”ê¿”ìš”",
  "ì˜¤ëŠ˜ë„ ë¹›ë‚˜ëŠ” í•˜ë£¨","ë‹¹ì‹ ì˜ ë…¸ë ¥ì— ë°•ìˆ˜","ì¡°ê¸ˆì”© ë” ë‚˜ì•„ì§€ê³  ìˆì–´ìš”","ì˜¤ëŠ˜ë„ ëª©í‘œ í´ë¦¬ì–´!","ë‹¹ì‹ ì˜ ë£¨í‹´ì„ ì‘ì›í•´ìš”",
  "ì˜¤ëŠ˜ë„ í›Œë¥­í–ˆì–´ìš”!","í•œ ë°œì”© ë‚˜ì•„ê°€ëŠ” ìš©ê¸°","ë‹¹ì‹ ì˜ ê¾¸ì¤€í•¨ì´ ì¸ìƒì ì´ì—ìš”","ì˜¤ëŠ˜ë„ ì˜ ë‹¬ë ¸ì–´ìš”","ì´ ì—¬ì •ì´ ì˜ë¯¸ ìˆì–´ìš”",
  "ì˜¤ëŠ˜ë„ ìì‹ ì„ ë¯¿ì–´ìš”","ë§¤ì¼ ìŒ“ì´ëŠ” ë‹¹ì‹ ì˜ ê¸°ë¡","ì˜¤ëŠ˜ì˜ ì™„ë£Œ ëŒ€ë‹¨í•´ìš”","ë‹¹ì‹ ì˜ ì„±ì‹¤í•¨ì„ ì‘ì›í•´ìš”","í•œ ê±¸ìŒì´ ë°± ê±¸ìŒ ë¼ìš”",
  "ì˜¤ëŠ˜ë„ ìµœê³ ì˜ í•˜ë£¨!","ë‹¹ì‹ ì€ ë§¤ì¼ ë¹›ë‚˜ìš”","ëª©í‘œë¥¼ í–¥í•œ ì—¬ì • ì¤‘","ì˜¤ëŠ˜ë„ ì´ê²¨ëƒˆì–´ìš”","íŒŒì´íŒ…, ì–¸ì œë‚˜!",
  "ë‹¹ì‹ ì˜ í•˜ë£¨ê°€ ê°€ë“ ì°¼ì–´ìš”","ì˜¤ëŠ˜ë„ ì™„ì£¼!","ì‘ì€ ì‹œì‘ì´ í° ì„±ê³µ","ë‹¹ì‹ ì„ ë¯¿ì–´ìš”","ì˜¤ëŠ˜ë„ ì¶©ì‹¤í•œ í•˜ë£¨",
  "ë§¤ì¼ ë‚˜ì•„ì§€ëŠ” ë‹¹ì‹ ","ì˜¤ëŠ˜ë„ ì™„ë²½í•œ ì„ íƒ!","í•œ ê±¸ìŒ í•œ ê±¸ìŒì´ ê°’ì ¸ìš”","ì˜¤ëŠ˜ ì •ë§ ì˜ í–ˆì–´ìš”","ë‚´ì¼ë„ ê¸°ëŒ€í•´ìš”!",
  "ì˜¤ëŠ˜ì˜ ì™„ë£Œê°€ ìë‘ìŠ¤ëŸ¬ì›Œìš”","ë‹¹ì‹ ì˜ ë…¸ë ¥ì´ ê½ƒí”¼ì›Œìš”","ì‰½ì§€ ì•Šì€ë° í•´ëƒˆì–´ìš”","ì˜¤ëŠ˜ë„ ìì‹ ì„ ë¯¿ì—ˆì–´ìš”","ì¡°ê¸ˆì”©, í•˜ì§€ë§Œ í™•ì‹¤í•˜ê²Œ",
  "ì˜¤ëŠ˜ë„ íŒŒì´íŒ… ë„˜ì¹˜ëŠ” í•˜ë£¨","ë‹¹ì‹ ì˜ ê²°ì‹¬ì´ ì¸ìƒì ì´ì—ìš”","ë§¤ì¼ ë” ê°•í•´ì§€ëŠ” ë‹¹ì‹ ","ì˜¤ëŠ˜ë„ ì„±ê³µì ì¸ í•˜ë£¨","ë‹¹ì‹ ì˜ ì—¬ì • ì‘ì›í•´ìš”",
  "ì˜¤ëŠ˜ë„ ë¹›ë‚˜ëŠ” ì„±ì·¨","ì‘ì€ ì™„ë£Œê°€ í° ê¸°ì¨","ë‹¹ì‹ ì˜ ëˆê¸°ë¥¼ ì‘ì›í•´ìš”","ì˜¤ëŠ˜ë„ ê¸°íŠ¹í•œ í•˜ë£¨","í•œ ê±¸ìŒì”© ê°€ë©´ ë¼ìš”",
  "ì˜¤ëŠ˜ì˜ ë…¸ë ¥ ë©‹ì ¸ìš”","ë‹¹ì‹ ì€ í¬ê¸°í•˜ì§€ ì•Šì•„ìš”","ë§¤ì¼ í•œ ê±¸ìŒì”© ì•ìœ¼ë¡œ","ì˜¤ëŠ˜ë„ ì™„ë²½í•œ ë§ˆë¬´ë¦¬","ë‹¹ì‹ ì˜ ê¾¸ì¤€í•¨ì´ ë¹›ë‚˜ìš”",
  "ì˜¤ëŠ˜ë„ ëŒ€ë‹¨í•œ í•˜ë£¨!","ì‘ì€ ë…¸ë ¥ì´ ìŒ“ì—¬ í° ì‚°ì´ ë¼ìš”","ë‹¹ì‹ ì˜ í•˜ë£¨ë¥¼ ì‘ì›í•´ìš”","ì˜¤ëŠ˜ë„ í›Œë¥­í•œ ì™„ë£Œ!","ë‚´ ë£¨í‹´ ë‚´ê°€ ì§€í‚¨ë‹¤",
  "ì˜¤ëŠ˜ë„ ìµœê³ ì˜ ë‚˜!","ë‹¹ì‹ ì˜ ë…¸ë ¥ ìŠì§€ ì•Šì•„ìš”","ë§¤ì¼ ì„±ì¥í•˜ê³  ìˆì–´ìš”","ì˜¤ëŠ˜ë„ ì¢‹ì€ í•˜ë£¨ ë§ˆë¬´ë¦¬","ë‹¹ì‹ ì˜ ëª©í‘œê°€ ì´ë£¨ì–´ì ¸ìš”",
  "ì˜¤ëŠ˜ë„ íŒŒì´íŒ…!","ì‘ì€ ê²ƒì´ ëª¨ì—¬ ìœ„ëŒ€í•´ì ¸ìš”","ë‹¹ì‹ ì˜ í•˜ë£¨ê°€ ì†Œì¤‘í•´ìš”","ì˜¤ëŠ˜ë„ ì˜ ì´ê²¨ëƒˆì–´ìš”","í•œ ê±¸ìŒì´ ê¸°ì ì˜ ì‹œì‘"
];

// ===== ì•„ë°”íƒ€ í”½ì…€ ë°ì´í„° (10ë‹¨ê³„, 16Ã—16) =====
// íŒ”ë ˆíŠ¸: 0=íˆ¬ëª…, 1=ê²€ì •, 2=ê°ˆìƒ‰, 3=ë…¸ë‘, 4=ì´ˆë¡, 5=í•˜ëŠ˜, 6=ë¹¨ê°•, 7=ì£¼í™©, 8=ë¶„í™, 9=í°ìƒ‰, A=ë°ì€ì´ˆë¡, B=ì—°ê°ˆìƒ‰
const PAL = {
  0:'rgba(0,0,0,0)', 1:'#1a1a1a', 2:'#8B5E3C', 3:'#F5C518', 4:'#2ecc40',
  5:'#35c8f1', 6:'#e74c3c', 7:'#f39c12', 8:'#f1a7d0', 9:'#f0f0f0',
  A:'#c8f135', B:'#d4a574'
};

// 10ë‹¨ê³„ ì•„ë°”íƒ€ í”½ì…€ë§µ (16Ã—16, ê° ë‹¨ê³„ ê³ ìœ  ë™ë¬¼)
const AVATAR_STAGES = [
  // 1ë‹¨ê³„: ì•Œ
  {name:'ì•Œ',pixels:`0000000000000000
0000001110000000
0000012221000000
0000121221100000
0001212222110000
0001222222110000
0001222922110000
0001222222110000
0001222222110000
0000122221100000
0000012221000000
0000001110000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000`.replace(/\n/g,'')},

  // 2ë‹¨ê³„: ë³‘ì•„ë¦¬
  {name:'ë³‘ì•„ë¦¬',pixels:`0000000000000000
0000033330000000
0003337333300000
0003337333300000
0033337333330000
0033399333330000
0033399333830000
0033339999330000
0003333333300000
0000333333000000
0000007700000000
0000007700000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000`.replace(/\n/g,'')},

  // 3ë‹¨ê³„: ê³ ì–‘ì´
  {name:'ê³ ì–‘ì´',pixels:`0000000000000000
0001100000011000
0011110000111100
0011119991111100
0011929929111100
0001199991110000
0000119911000000
0000111111000000
0000122221000000
0001222222100000
0001222222100000
0000122221000000
0002100001200000
0002100001200000
0000000000000000
0000000000000000`.replace(/\n/g,'')},

  // 4ë‹¨ê³„: ê°•ì•„ì§€
  {name:'ê°•ì•„ì§€',pixels:`0000000000000000
0002200000000000
0022200000000000
0022299000000000
0122992299000000
0122299922100000
0012299922100000
0001222221000000
0001222221000000
0001222291000000
0000122210000000
0000122210000000
0001100011000000
0001100011000000
0000000000000000
0000000000000000`.replace(/\n/g,'')},

  // 5ë‹¨ê³„: ì—¬ìš°
  {name:'ì—¬ìš°',pixels:`0000000000000000
0007700000077000
0077770000777700
0077739993777700
0177799997777100
0177799997771100
0017779997710000
0001777777100000
0001777777100000
0001777777100000
0000177771000000
0000177771000000
0002177712000000
0002100012000000
0000000000000000
0000000000000000`.replace(/\n/g,'')},

  // 6ë‹¨ê³„: íŒë‹¤
  {name:'íŒë‹¤',pixels:`0000000000000000
0011100000111000
0191100001191000
0119999999911000
0119929299911000
0199922299991000
0199922299991000
0019992299910000
0001999999100000
0000199991000000
0000199991000000
0000119911000000
0000119911000000
0000100001000000
0000000000000000
0000000000000000`.replace(/\n/g,'')},

  // 7ë‹¨ê³„: í† ë¼
  {name:'í† ë¼',pixels:`0000000000000000
0001100000110000
0001100000110000
0009900000990000
0009990099990000
0099992299990000
0099922999990000
0099929299990000
0009999999900000
0009999999900000
0009929299900000
0000992299000000
0001199911000000
0001100011000000
0000000000000000
0000000000000000`.replace(/\n/g,'')},

  // 8ë‹¨ê³„: ì‚¬ì
  {name:'ì‚¬ì',pixels:`0000000000000000
0000727722700000
0007277277270000
0072729972720000
0727729972720000
0727722227270000
0727722227270000
0727722222720000
0727222222720000
0072222222700000
0007222222000000
0000722270000000
0000022200000000
0000002000000000
0000000000000000
0000000000000000`.replace(/\n/g,'')},

  // 9ë‹¨ê³„: ë“œë˜ê³¤
  {name:'ë“œë˜ê³¤',pixels:`0000000000000000
0004400000044000
0044440000444400
0444449994444400
0444499994444400
4444992299444400
0444A99994444000
0044A999A444000
0004444444400000
0004444444400000
0004444444400000
0000444444000000
0000044440000000
0000004400000000
0000000000000000
0000000000000000`.replace(/\n/g,'')},

  // 10ë‹¨ê³„: ìœ ë‹ˆì½˜
  {name:'ìœ ë‹ˆì½˜',pixels:`0000000000000000
0000009000000000
0000099000000000
0009999000000000
0099999990000000
0999999A99000000
0A99A999A9900000
0AA9AA99AA90000
0099999999900000
0009999999000000
0009929299000000
0000992299000000
0000099990000000
0000009900000000
0000000000000000
0000000000000000`.replace(/\n/g,'')},
];

// ===== ìƒíƒœ =====
let currentUser = null;
let localDash = null;
let activeGoalIdx = null;
let viewMonth = null; // {year, month}

// ===== í™”ë©´ ì „í™˜ =====
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0, 0);
}

// ===== ë¡œê·¸ì¸ =====
async function initAdmin() {
  const snap = await get(ref(db, 'users/admin'));
  if (!snap.exists()) await set(ref(db, 'users/admin'), { name:'ê´€ë¦¬ì', password:'admin1234', role:'admin' });
  showScreen('loginScreen');
}
initAdmin();

window.doLogin = async function() {
  const id = document.getElementById('loginId').value.trim();
  const pw = document.getElementById('loginPw').value;
  const btn = document.getElementById('loginBtn');
  if (!id || !pw) return;
  btn.disabled = true; btn.textContent = 'í™•ì¸ ì¤‘...';
  try {
    const snap = await get(ref(db, `users/${id}`));
    if (!snap.exists() || snap.val().password !== pw) {
      document.getElementById('loginError').style.display = 'block';
    } else {
      document.getElementById('loginError').style.display = 'none';
      const u = snap.val();
      currentUser = { id, ...u };
      if (u.role === 'admin') {
        showScreen('adminScreen'); renderAdminUserList();
      } else {
        document.getElementById('navUserName').textContent = u.name;
        await loadDash();
        showScreen('dashboardScreen');
        renderDashboard();
      }
    }
  } catch(e) { showToast('âŒ ì—°ê²° ì˜¤ë¥˜'); }
  btn.disabled = false; btn.textContent = 'ë¡œê·¸ì¸';
};

['loginId','loginPw'].forEach(id => {
  document.getElementById(id).addEventListener('keydown', e => { if (e.key === 'Enter') window.doLogin(); });
});

window.doLogout = function() {
  currentUser = null; localDash = null; activeGoalIdx = null;
  document.getElementById('loginId').value = '';
  document.getElementById('loginPw').value = '';
  showScreen('loginScreen');
};

// ===== DB =====
async function loadDash() {
  const snap = await get(ref(db, `dashboards/${currentUser.id}`));
  localDash = snap.exists() ? snap.val() : {};
  if (!localDash.goals) localDash.goals = [];
  if (!localDash.completions) localDash.completions = {};
}

async function saveDash() {
  await set(ref(db, `dashboards/${currentUser.id}`), localDash);
}

// ===== ADMIN =====
async function renderAdminUserList() {
  const snap = await get(ref(db, 'users'));
  const chips = document.getElementById('adminUserChips');
  if (!snap.exists()) { chips.innerHTML = '<div style="color:var(--text-dim);padding:20px 0;text-align:center;width:100%">ë“±ë¡ëœ ìœ ì € ì—†ìŒ</div>'; return; }
  const users = Object.entries(snap.val()).filter(([,u]) => u.role !== 'admin');
  chips.innerHTML = users.length === 0
    ? '<div style="color:var(--text-dim);padding:20px 0;text-align:center;width:100%">ë“±ë¡ëœ ìœ ì € ì—†ìŒ</div>'
    : users.map(([id,u]) => `<div class="user-chip"><span class="user-chip-name">${esc(u.name)}</span><span class="user-chip-id">@${esc(id)}</span></div>`).join('');
}

window.createUser = async function() {
  const name = document.getElementById('newUserName').value.trim();
  const id = document.getElementById('newUserId').value.trim();
  const pw = document.getElementById('newUserPw').value.trim();
  if (!name || !id || !pw) { showToast('âŒ ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
  const snap = await get(ref(db, `users/${id}`));
  if (snap.exists()) { showToast('âŒ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””'); return; }
  await set(ref(db, `users/${id}`), { name, password: pw, role: 'user' });
  document.getElementById('newUserName').value = '';
  document.getElementById('newUserId').value = '';
  document.getElementById('newUserPw').value = '';
  showToast(`âœ… ${name} ê³„ì • ìƒì„± ì™„ë£Œ!`);
  renderAdminUserList();
};

// ===== ì§„ì²™ë¥  ê³„ì‚° =====
function getMonthInfo(year, month) {
  // í•´ë‹¹ ì›” ì¼ìˆ˜
  const daysInMonth = new Date(year, month, 0).getDate();
  // í•´ë‹¹ ì›” ì£¼ ìˆ˜ ê³„ì‚° (ì›”ìš”ì¼ ê¸°ì¤€)
  let weeks = 0;
  let d = new Date(year, month - 1, 1);
  while (d.getMonth() === month - 1) {
    // ì£¼ì˜ ì‹œì‘(ì›”)ì„ ê¸°ì¤€ìœ¼ë¡œ
    if (d.getDay() === 1 || d.getDate() === 1) weeks++;
    d.setDate(d.getDate() + 7);
  }
  // ë” ë‹¨ìˆœí•˜ê²Œ: ceil(daysInMonth / 7)
  weeks = Math.ceil(daysInMonth / 7);
  return { daysInMonth, weeks };
}

function getGoalModulus(goal, year, month) {
  const unit = goal.unit;
  if (!unit || unit === 'once') return 1;
  const { daysInMonth, weeks } = getMonthInfo(year, month);
  if (unit === 'daily') return daysInMonth;
  const freq = UNIT_FREQ[unit] || 1;
  return freq * weeks;
}

function getGoalCompleted(goal, goalIdx, year, month) {
  if (!goal.unit || goal.unit === 'once') {
    const key = `g${goalIdx}_once`;
    return (localDash.completions[key] === true) ? 1 : 0;
  }
  const prefix = `g${goalIdx}_${year}_${month}_`;
  let count = 0;
  Object.entries(localDash.completions).forEach(([k, v]) => {
    if (k.startsWith(prefix) && v === true) count++;
  });
  return count;
}

function calcGoalPct(goal, goalIdx, year, month) {
  const mod = getGoalModulus(goal, year, month);
  const done = getGoalCompleted(goal, goalIdx, year, month);
  return { done, mod, pct: mod > 0 ? Math.min(100, Math.round((done / mod) * 100)) : 0 };
}

function calcGlobalPct() {
  const now = new Date();
  const y = now.getFullYear(), m = now.getMonth() + 1;
  const allGoals = getAllGoals();
  let totalDone = 0, totalMod = 0;
  allGoals.forEach((g, i) => {
    if (!g || !g.unit) return;
    const { done, mod } = calcGoalPct(g, i, y, m);
    totalDone += done;
    totalMod += mod;
  });
  return totalMod > 0 ? Math.round((totalDone / totalMod) * 100) : 0;
}

function getAllGoals() {
  // ìŠ¬ë¡¯ 0ì€ ê³ ì •
  const goals = [{ ...FIXED_GOAL, ...(localDash.goals[0] || {}) }];
  for (let i = 1; i < 5; i++) goals.push(localDash.goals[i] || null);
  return goals;
}

// ===== ëŒ€ì‹œë³´ë“œ ë Œë” =====
function renderDashboard() {
  const now = new Date();
  if (!viewMonth) viewMonth = { year: now.getFullYear(), month: now.getMonth() + 1 };

  renderGlobalProgress();
  renderGoalButtons();
  renderAvatar();

  // ì²« ë²ˆì§¸ ëª©í‘œ(ê³ ì •) ìë™ ì„ íƒ
  if (activeGoalIdx === null) {
    activeGoalIdx = 0;
    renderDetailPanel(0);
  }
}

function renderGlobalProgress() {
  const pct = calcGlobalPct();
  document.getElementById('gpFill').style.width = pct + '%';
  document.getElementById('gpPct').textContent = pct + '%';
}

function renderGoalButtons() {
  const goals = getAllGoals();
  const now = new Date();
  const y = now.getFullYear(), m = now.getMonth() + 1;
  let html = '';
  for (let i = 0; i < 5; i++) {
    const g = goals[i];
    if (i === 0 && (!g || !g.unit)) {
      // ê³ ì • ëª©í‘œì´ì§€ë§Œ ë‹¨ìœ„ ë¯¸ì„¤ì •
      html += `<button class="goal-btn ${activeGoalIdx===0?'active':''}" onclick="selectGoal(0)">
        <div class="goal-btn-title">12ì‹œì— ëˆ•ê¸°</div>
        <div class="goal-btn-pct" style="color:var(--text-dim);font-size:12px;">ë‹¨ìœ„ ì„¤ì • í•„ìš”</div>
      </button>`;
    } else if (!g) {
      html += `<button class="goal-btn disabled"><div class="goal-btn-title">+ ëª©í‘œ ì¶”ê°€</div></button>`;
    } else if (!g.unit) {
      html += `<button class="goal-btn ${activeGoalIdx===i?'active':''}" onclick="selectGoal(${i})">
        <div class="goal-btn-title">${esc(g.title||'ëª©í‘œ'+(i+1))}</div>
        <div class="goal-btn-pct" style="color:var(--text-dim);font-size:12px;">ë‹¨ìœ„ ì„¤ì • í•„ìš”</div>
      </button>`;
    } else {
      const { pct } = calcGoalPct(g, i, y, m);
      html += `<button class="goal-btn ${activeGoalIdx===i?'active':''}" onclick="selectGoal(${i})">
        <div class="goal-btn-title">${esc(g.title||(i===0?'12ì‹œì— ëˆ•ê¸°':'ëª©í‘œ'+(i+1)))}</div>
        <div class="goal-btn-pct">${pct}%</div>
        <div class="goal-btn-bar"><div class="goal-btn-fill" style="width:${pct}%"></div></div>
      </button>`;
    }
  }
  document.getElementById('goalBtnList').innerHTML = html;
}

window.selectGoal = function(idx) {
  activeGoalIdx = idx;
  renderGoalButtons();
  renderDetailPanel(idx);
};

function renderDetailPanel(idx) {
  const goals = getAllGoals();
  const g = goals[idx];
  const panel = document.getElementById('detailPanel');

  // ëª©í‘œ ì—†ê±°ë‚˜ ë¹„ì–´ìˆìœ¼ë©´ ì¶”ê°€ UI
  if (!g) {
    panel.innerHTML = `<div style="padding:32px">
      <div class="unit-setup">
        <div class="unit-setup-title">ìƒˆ ëª©í‘œ ì¶”ê°€</div>
        <div class="unit-setup-sub">ëª©í‘œ ì´ë¦„ì„ ì…ë ¥í•˜ê³  ë‹¨ìœ„ë¥¼ ì„¤ì •í•˜ì„¸ìš”</div>
        <input type="text" id="newGoalTitle" placeholder="ëª©í‘œ ì´ë¦„" style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:12px 14px;color:var(--text);font-size:15px;font-family:'Noto Sans KR',sans-serif;outline:none;margin-bottom:16px;">
        <div class="unit-options" id="unitOpts${idx}"></div>
        <button class="unit-confirm-btn" onclick="saveNewGoal(${idx})">ëª©í‘œ ë“±ë¡</button>
      </div>
    </div>`;
    renderUnitOptions(`unitOpts${idx}`, null, idx, true);
    return;
  }

  // ë‹¨ìœ„ ë¯¸ì„¤ì •
  if (!g.unit) {
    panel.innerHTML = `<div style="padding:32px">
      <div class="unit-setup">
        <div class="unit-setup-title">${esc(g.title||(idx===0?'12ì‹œì— ëˆ•ê¸°':'ëª©í‘œ'))}</div>
        <div class="unit-setup-sub">ì´ ëª©í‘œì˜ ë‹¬ì„± ë‹¨ìœ„ë¥¼ ì„¤ì •í•˜ì„¸ìš”</div>
        <div class="unit-options" id="unitOpts${idx}"></div>
        <button class="unit-confirm-btn" onclick="confirmUnit(${idx})">ë‹¨ìœ„ ì„¤ì • ì™„ë£Œ</button>
      </div>
    </div>`;
    renderUnitOptions(`unitOpts${idx}`, null, idx, false);
    return;
  }

  // ë‹¨ìœ„ ì„¤ì •ë¨ â†’ ë‹¬ë ¥ ë˜ëŠ” í•œë²ˆ UI
  if (g.unit === 'once') {
    renderOncePanel(panel, g, idx);
  } else {
    renderCalendarPanel(panel, g, idx);
  }
}

let selectedUnit = {};

function renderUnitOptions(containerId, currentUnit, idx, isNew) {
  const container = document.getElementById(containerId);
  if (!container) return;
  if (!selectedUnit[idx]) selectedUnit[idx] = currentUnit || null;
  const units = ['once','daily','w1','w2','w4','w6'];
  container.innerHTML = units.map(u =>
    `<div class="unit-opt ${selectedUnit[idx]===u?'selected':''}" onclick="selectUnit('${u}',${idx},'${containerId}')">${UNIT_LABELS[u]}</div>`
  ).join('');
}

window.selectUnit = function(u, idx, containerId) {
  selectedUnit[idx] = u;
  renderUnitOptions(containerId, u, idx, false);
};

window.confirmUnit = async function(idx) {
  const u = selectedUnit[idx];
  if (!u) { showToast('ë‹¨ìœ„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”'); return; }
  if (!localDash.goals[idx]) localDash.goals[idx] = {};
  localDash.goals[idx].unit = u;
  if (idx === 0 && !localDash.goals[0].title) localDash.goals[0].title = '12ì‹œì— ëˆ•ê¸°';
  await saveDash();
  showToast('âœ… ë‹¨ìœ„ ì„¤ì • ì™„ë£Œ!');
  renderGoalButtons();
  renderDetailPanel(idx);
  renderGlobalProgress();
};

window.saveNewGoal = async function(idx) {
  const titleEl = document.getElementById('newGoalTitle');
  const title = titleEl ? titleEl.value.trim() : '';
  const u = selectedUnit[idx];
  if (!title) { showToast('ëª©í‘œ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
  if (!u) { showToast('ë‹¨ìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš”'); return; }
  if (!localDash.goals[idx]) localDash.goals[idx] = {};
  localDash.goals[idx].title = title;
  localDash.goals[idx].unit = u;
  await saveDash();
  showToast('ğŸ¯ ëª©í‘œ ë“±ë¡ ì™„ë£Œ!');
  renderGoalButtons();
  renderDetailPanel(idx);
  renderGlobalProgress();
};

window.enterEditUnit = function(idx) {
  const goals = getAllGoals();
  const g = goals[idx];
  const panel = document.getElementById('detailPanel');
  panel.innerHTML = `<div style="padding:32px">
    <div class="unit-setup">
      <div class="unit-setup-title">${esc(g.title||'ëª©í‘œ')}</div>
      <div class="unit-setup-sub">ë‹¨ìœ„ë¥¼ ìˆ˜ì •í•˜ì„¸ìš”</div>
      <div class="unit-options" id="unitOpts${idx}"></div>
      <div style="display:flex;gap:10px;margin-top:4px;">
        <button class="unit-confirm-btn" onclick="confirmUnit(${idx})">ìˆ˜ì • ì™„ë£Œ</button>
        <button onclick="renderDetailPanel(${idx})" style="background:transparent;border:1px solid var(--border);color:var(--text-dim);border-radius:8px;padding:13px 20px;font-size:14px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>`;
  selectedUnit[idx] = g.unit;
  renderUnitOptions(`unitOpts${idx}`, g.unit, idx, false);
};

// ===== í•œë²ˆ ì™„ë£Œ íŒ¨ë„ =====
function renderOncePanel(panel, g, idx) {
  const key = `g${idx}_once`;
  const done = localDash.completions[key] === true;
  panel.innerHTML = `<div style="padding:32px">
    <div class="calendar-header">
      <div class="cal-goal-title">${esc(g.title||(idx===0?'12ì‹œì— ëˆ•ê¸°':'ëª©í‘œ'))}</div>
      <div class="cal-meta">
        <div class="cal-unit-badge">${UNIT_LABELS[g.unit]}</div>
        <button class="edit-unit-btn" onclick="enterEditUnit(${idx})">ë‹¨ìœ„ ìˆ˜ì •</button>
      </div>
    </div>
    <div class="once-panel">
      <div class="once-title">ì´ ëª©í‘œëŠ” ë‹¨ í•œ ë²ˆì˜ ì™„ë£Œê°€ í•„ìš”í•©ë‹ˆë‹¤</div>
      <div class="once-sub">ì™„ë£Œí•˜ë©´ 100% ë‹¬ì„±!</div>
      <button class="once-btn ${done?'completed':''}" onclick="toggleOnce(${idx})">
        ${done ? 'âœ…' : 'â—‹'}
      </button>
      ${done ? '<div class="once-done-label">ğŸ‰ ì™„ë£Œ!</div>' : ''}
    </div>
  </div>`;
}

window.toggleOnce = async function(idx) {
  const key = `g${idx}_once`;
  const cur = localDash.completions[key] === true;
  localDash.completions[key] = !cur;
  await saveDash();
  showToast(!cur ? 'ğŸ‰ ì™„ë£Œ!' : 'â†©ï¸ í•´ì œ');
  renderDetailPanel(idx);
  renderGoalButtons();
  renderGlobalProgress();
  renderAvatar();
};

// ===== ë‹¬ë ¥ íŒ¨ë„ =====
function renderCalendarPanel(panel, g, idx) {
  const now = new Date();
  if (!viewMonth) viewMonth = { year: now.getFullYear(), month: now.getMonth() + 1 };
  const { year, month } = viewMonth;
  const { done, mod, pct } = calcGoalPct(g, idx, year, month);
  const monthLabel = `${year}ë…„ ${month}ì›”`;

  // ë‹¬ë ¥ ìƒì„±
  const firstDay = new Date(year, month - 1, 1).getDay(); // 0=ì¼
  const daysInMonth = new Date(year, month, 0).getDate();
  const DAY_LABELS = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
  const freq = UNIT_FREQ[g.unit] || 1;

  // ì£¼ë³„ ì™„ë£Œ ìˆ˜ ê³„ì‚°
  function getWeekCompletions(weekDates) {
    return weekDates.filter(d => {
      const key = `g${idx}_${year}_${month}_${d}`;
      return localDash.completions[key] === true;
    }).length;
  }

  // ë‚ ì§œë³„ ì£¼ ë°°ì—´ ìƒì„±
  let weeks = [];
  let week = [];
  for (let i = 0; i < firstDay; i++) week.push(0);
  for (let d = 1; d <= daysInMonth; d++) {
    week.push(d);
    if (week.length === 7) { weeks.push(week); week = []; }
  }
  if (week.length > 0) { while (week.length < 7) week.push(0); weeks.push(week); }

  let calHtml = `<div class="cal-grid-header">${DAY_LABELS.map(l=>`<div class="cal-day-label">${l}</div>`).join('')}</div><div class="cal-grid">`;

  weeks.forEach(w => {
    const validDates = w.filter(d => d > 0);
    const weekDone = getWeekCompletions(validDates);
    const weekComplete = weekDone >= freq;

    w.forEach(d => {
      if (d === 0) { calHtml += `<div class="cal-cell empty"></div>`; return; }
      const cellDate = new Date(year, month - 1, d);
      const isToday = cellDate.toDateString() === now.toDateString();
      const isFuture = cellDate > now;
      const key = `g${idx}_${year}_${month}_${d}`;
      const isDone = localDash.completions[key] === true;
      const cls = ['cal-cell',
        isDone?'done':'',
        isFuture?'future':'',
        isToday?'cal-today':'',
        (!isDone && weekComplete && !isFuture)?'week-complete':''
      ].filter(Boolean).join(' ');
      calHtml += `<div class="${cls}" onclick="${isFuture?'':(`toggleDay(${idx},${d})`)}">
        <div class="cal-date">${d}</div>
        <div class="cal-check">âœ“</div>
      </div>`;
    });
  });
  calHtml += '</div>';

  const isCurrentMonth = year === now.getFullYear() && month === now.getMonth() + 1;

  panel.innerHTML = `<div style="padding:24px">
    <div class="calendar-header">
      <div class="cal-goal-title">${esc(g.title||(idx===0?'12ì‹œì— ëˆ•ê¸°':'ëª©í‘œ'))}</div>
      <div class="cal-meta">
        <div class="cal-unit-badge">${UNIT_LABELS[g.unit]}</div>
        <button class="edit-unit-btn" onclick="enterEditUnit(${idx})">ë‹¨ìœ„ ìˆ˜ì •</button>
      </div>
    </div>
    <div class="month-nav">
      <button class="month-nav-btn" onclick="changeMonth(-1)">â€¹</button>
      <div class="month-label">${monthLabel}</div>
      <button class="month-nav-btn" onclick="changeMonth(1)" ${isCurrentMonth?'disabled style="opacity:.4;cursor:default"':''}>â€º</button>
    </div>
    ${calHtml}
    <div class="month-progress">
      <div class="mp-label">ì´ë²ˆ ë‹¬ ì§„ì²™</div>
      <div class="mp-track"><div class="mp-fill" style="width:${pct}%"></div></div>
      <div class="mp-nums">${done}/${mod} Â· ${pct}%</div>
    </div>
  </div>`;
}

window.changeMonth = function(dir) {
  let { year, month } = viewMonth;
  month += dir;
  if (month < 1) { month = 12; year--; }
  if (month > 12) { month = 1; year++; }
  const now = new Date();
  if (year > now.getFullYear() || (year === now.getFullYear() && month > now.getMonth() + 1)) return;
  viewMonth = { year, month };
  renderDetailPanel(activeGoalIdx);
};

window.toggleDay = async function(idx, day) {
  const { year, month } = viewMonth;
  const key = `g${idx}_${year}_${month}_${day}`;
  const cur = localDash.completions[key] === true;
  localDash.completions[key] = !cur;
  await saveDash();
  showToast(!cur ? 'âœ… ì™„ë£Œ!' : 'â†©ï¸ í•´ì œ');
  renderDetailPanel(idx);
  renderGoalButtons();
  renderGlobalProgress();
  renderAvatar();
};

// ===== ì•„ë°”íƒ€ =====
function renderAvatar() {
  const pct = calcGlobalPct();
  const stage = Math.min(9, Math.floor(pct / 10)); // 0~9
  const stageData = AVATAR_STAGES[stage];

  // ìº”ë²„ìŠ¤ ê·¸ë¦¬ê¸°
  const canvas = document.getElementById('avatarCanvas');
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, 16, 16);
  const px = stageData.pixels;
  for (let y = 0; y < 16; y++) {
    for (let x = 0; x < 16; x++) {
      const c = px[y * 16 + x];
      if (c !== '0') {
        ctx.fillStyle = PAL[c] || '#fff';
        ctx.fillRect(x, y, 1, 1);
      }
    }
  }

  document.getElementById('avatarStageName').textContent = `${stage + 1}ë‹¨ê³„ Â· ${stageData.name}`;

  // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë°˜ ëœë¤ ë©˜íŠ¸ (ë§¤ì¼ ê³ ì •)
  const today = new Date();
  const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);
  const msgIdx = dayOfYear % CHEERS.length;
  document.getElementById('avatarMsg').textContent = CHEERS[msgIdx];
}

// ===== ìœ í‹¸ =====
function esc(str) {
  const d = document.createElement('div');
  d.textContent = str;
  return d.innerHTML;
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(t._timer);
  t._timer = setTimeout(() => t.classList.remove('show'), 2200);
}
window.showToast = showToast;
window.renderDetailPanel = renderDetailPanel;
</script>
</body>
</html>
